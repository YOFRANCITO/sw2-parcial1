{% extends "base.html" %}

{% block title %}Iniciar escaneo · Escáner{% endblock %}

{% block alerts %}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
          {{ message }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
{% endblock %}

{% block content %}
  <!-- Card protagonista: Escanear URL -->
  <section class="my-4">
    <div class="aurora-card mx-auto p-4 p-md-5" style="max-width: 760px;">
      <h2 class="h4 fw-bold mb-3">Escanear URL</h2>
      <form action="{{ url_for('start_scan') }}" method="post" id="scanForm">
        <div class="input-group input-group-lg mb-3">
          <span class="input-group-text"><i class="fas fa-globe"></i></span>
          <input type="url" class="form-control" id="url" name="url" placeholder="https://tu-sitio.com" required>
        </div>
        <button type="submit" class="btn btn-gradient btn-lg w-100 rounded-pill" id="scanBtn">
          <i class="fas fa-search me-2"></i> Escanear
        </button>
        <div class="form-text mt-2">Incluye <strong>http://</strong> o <strong>https://</strong></div>
      </form>
    </div>
  </section>

  <!-- Chips de vulnerabilidades -->
  <section class="my-4 text-center">
    <ul class="list-unstyled d-flex flex-wrap justify-content-center gap-2">
      <li class="chip chip-sqli"><i class="fas fa-database"></i> SQL Injection</li>
      <li class="chip chip-xss"><i class="fas fa-code"></i> XSS</li>
      <li class="chip chip-click"><i class="fas fa-mouse-pointer"></i> Clickjacking</li>
      <li class="chip chip-headers"><i class="fas fa-lock"></i> Security Headers</li>
      <li class="chip chip-redirect"><i class="fas fa-random"></i> Open Redirect</li>
      <li class="chip chip-csrf"><i class="fas fa-key"></i> CSRF</li>
    </ul>
  </section>

  <!-- Stepper -->
  <section class="my-5">
    <div class="row g-4 stepper">
      <div class="col-md-4">
        <div class="step">
          <div class="step-number">1</div>
          <h5>Ingresar URL</h5>
          <p class="mb-0 text-muted">Pega la dirección completa del sitio.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="step">
          <div class="step-number">2</div>
          <h5>Analizar</h5>
          <p class="mb-0 text-muted">Ejecuta el escaneo de seguridad.</p>
        </div>
      </div>
      <div class="col-md-4">
        <div class="step">
          <div class="step-number">3</div>
          <h5>Ver reporte</h5>
          <p class="mb-0 text-muted">Revisa el resumen y los detalles.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Tips -->
  <section class="my-4">
    <div class="aurora-tip p-3">
      <i class="fas fa-circle-info me-2"></i>
      Usa esta herramienta de forma ética. Escanea sitios que te pertenezcan o cuenten con autorización.
    </div>
  </section>
{% endblock %}

{% block scripts %}
<script>
  // spinner simple al enviar (no toca backend)
  const form = document.getElementById('scanForm');
  const btn  = document.getElementById('scanBtn');
  form.addEventListener('submit', () => {
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Escaneando...';
  });
  // si el usuario vuelve atrás, rearmar botón
  window.addEventListener('pageshow', () => {
    btn.disabled = false;
    btn.innerHTML = '<i class="fas fa-search me-2"></i> Escanear';
  });
</script>
{% endblock %}
